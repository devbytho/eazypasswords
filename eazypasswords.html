<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurePass - Password Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <!-- Auth Screens -->
    <div class="auth-container" id="authContainer">
        <!-- Login Screen -->
        <div class="auth-box" id="loginScreen">
            <div class="auth-logo">
                <i class="fas fa-lock"></i>
                <h1>SecurePass</h1>
                <p>Your secure password manager</p>
            </div>

            <div class="alert" id="loginAlert"></div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email">
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-input">
                    <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                    <button type="button" class="toggle-password" data-action="togglePassword" data-arg="loginPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <button class="btn btn-primary" data-action="login">Sign In</button>

            <div class="auth-footer">
                Don't have an account? <span class="auth-link" data-action="showAuthScreen" data-arg="registerScreen">Sign Up</span>
            </div>

            <div class="text-center mt-15">
                <span class="auth-link" data-action="showAuthScreen" data-arg="forgotPasswordScreen">Forgot Password?</span>
            </div>
        </div>

        <!-- Register Screen -->
        <div class="auth-box hidden" id="registerScreen">
            <div class="auth-logo">
                <i class="fas fa-lock"></i>
                <h1>Create Account</h1>
                <p>Join SecurePass today</p>
            </div>

            <div class="alert" id="registerAlert"></div>

            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" id="registerName" placeholder="Enter your full name">
            </div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="registerEmail" placeholder="Enter your email">
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-input">
                    <input type="password" class="form-control" id="registerPassword" placeholder="Create a password">
                    <button type="button" class="toggle-password" data-action="togglePassword" data-arg="registerPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">4-Digit PIN</label>
                <input type="password" class="form-control" id="registerPin" placeholder="Enter a 4-digit PIN" maxlength="4" pattern="\d{4}">
            </div>

            <button class="btn btn-primary" data-action="register">Create Account</button>

            <div class="auth-footer">
                Already have an account? <span class="auth-link" data-action="showAuthScreen" data-arg="loginScreen">Sign In</span>
            </div>
        </div>

        <!-- Verify Email Screen -->
        <div class="auth-box hidden" id="verifyScreen">
            <div class="auth-logo">
                <i class="fas fa-envelope"></i>
                <h1>Verify Email</h1>
                <p>Enter the code sent to your email</p>
            </div>

            <div class="alert" id="verifyAlert"></div>

            <div class="form-group">
                <label class="form-label">Verification Code</label>
                <input type="text" class="form-control" id="verifyCode" placeholder="Enter 6-digit code">
            </div>

            <button class="btn btn-primary" data-action="verifyEmail">Verify Email</button>

            <div class="auth-footer">
                Didn't receive code? <span class="auth-link" data-action="resendCode">Resend</span>
            </div>
        </div>

        <!-- Forgot Password Screen -->
        <div class="auth-box hidden" id="forgotPasswordScreen">
            <div class="auth-logo">
                <i class="fas fa-key"></i>
                <h1>Reset Password</h1>
                <p>Enter your email to receive a reset link</p>
            </div>

            <div class="alert" id="forgotPasswordAlert"></div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="forgotPasswordEmail" placeholder="Enter your email">
            </div>

            <button class="btn btn-primary" data-action="sendResetLink">Send Reset Link</button>

            <div class="auth-footer">
                Remember your password? <span class="auth-link" data-action="showAuthScreen" data-arg="loginScreen">Sign In</span>
            </div>
        </div>

        <!-- Reset Password Screen -->
        <div class="auth-box hidden" id="resetPasswordScreen">
            <div class="auth-logo">
                <i class="fas fa-lock"></i>
                <h1>Create New Password</h1>
                <p>Enter your new password below</p>
            </div>

            <div class="alert" id="resetPasswordAlert"></div>

            <div class="form-group">
                <label class="form-label">New Password</label>
                <div class="password-input">
                    <input type="password" class="form-control" id="resetPassword" placeholder="Enter new password">
                    <button type="button" class="toggle-password" data-action="togglePassword" data-arg="resetPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <div class="password-input">
                    <input type="password" class="form-control" id="resetPasswordConfirm" placeholder="Confirm new password">
                    <button type="button" class="toggle-password" data-action="togglePassword" data-arg="resetPasswordConfirm">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <button class="btn btn-primary" data-action="resetPassword">Reset Password</button>

            <div class="auth-footer">
                <span class="auth-link" data-action="showAuthScreen" data-arg="loginScreen">Back to Login</span>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container" id="dashboardContainer">
        <div class="container">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="logo">
                    <i class="fas fa-lock"></i>
                    <h1>SecurePass</h1>
                </div>
                <ul class="nav-links">
                    <li><a href="#" class="active" data-action="showDashboardView" data-arg="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="passwords"><i class="fas fa-key"></i> All Passwords</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="sharingCenter"><i class="fas fa-share-alt"></i> Sharing Center</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="familySharing"><i class="fas fa-user-friends"></i> Family Sharing</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="subscription"><i class="fas fa-crown"></i> Subscription</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="settings"><i class="fas fa-cog"></i> Settings</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="security"><i class="fas fa-shield-alt"></i> Security</a></li>
                    <li><a href="#" data-action="showDashboardView" data-arg="activityLog"><i class="fas fa-history"></i> Activity Log</a></li>
                </ul>
                <div class="sidebar-footer">
                    <div class="upgrade-card" id="sidebarUpgradeCard">
                        <div class="upgrade-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="upgrade-title">Upgrade to Premium</div>
                        <div class="upgrade-description">Unlock advanced security features and sharing capabilities</div>
                        <button class="upgrade-btn-sidebar" data-action="showDashboardView" data-arg="subscription">
                            Upgrade Now
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="header">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search passwords..." data-keyup="searchPasswords">
                    </div>
                    <div class="user-actions">
                         <div class="scan-qr-btn" data-action="showQrScannerModal" title="Scan QR Code">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <div class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="notification-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="user-profile" data-action="logout">
                            <img src="" id="userAvatar" alt="User">
                            <span id="userName">User</span>
                        </div>
                    </div>
                </div>

                <!-- Dashboard View -->
                <div id="dashboardView">
                    <!-- Dashboard Cards -->
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Total Passwords</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-key"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalPasswords">0</div>
                            <div class="card-description">Secure passwords stored</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Security Score</div>
                                <div class="card-icon success">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                            </div>
                            <div class="card-value" id="securityScore">0%</div>
                            <div class="card-description" id="securityStatus">Calculating...</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Weak Passwords</div>
                                <div class="card-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div class="card-value" id="weakPasswords">0</div>
                            <div class="card-description">Needs attention</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Categories</div>
                                <div class="card-icon danger">
                                    <i class="fas fa-folder"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalCategories">0</div>
                            <div class="card-description">Different categories</div>
                        </div>
                    </div>

                    <!-- Recent Passwords -->
                    <div class="password-list">
                        <div class="list-header">
                            <div class="list-title">Recently Added</div>
                            <button class="add-btn" data-action="showAddPasswordModal">
                                <i class="fas fa-plus"></i> Add Password
                            </button>
                        </div>
                        <div id="recentPasswordsList">
                            <div class="loading" id="recentPasswordsLoading">
                                <div class="spinner"></div>
                                <div>Loading passwords...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- All Passwords View -->
                <div id="passwordsView" class="hidden">
                    <div class="password-list">
                        <div class="list-header">
                            <div class="list-title">All Passwords</div>
                            
                            <div class="sort-container">
                                <label>Sort by:</label>
                                
                                <!-- [NEW] Fully Custom Dropdown HTML Structure -->
                                <div class="custom-dropdown" id="categoryDropdown">
                                    <div class="dropdown-selected">
                                        <span id="selectedCategoryText">All Categories</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="dropdown-option" data-value="all">All Categories</div>
                                        <div class="dropdown-option" data-value="Personal">Personal</div>
                                        <div class="dropdown-option" data-value="Work">Work</div>
                                        <div class="dropdown-option" data-value="Social">Social</div>
                                        <div class="dropdown-option" data-value="Banking">Banking</div>
                                        <div class="dropdown-option" data-value="Entertainment">Entertainment</div>
                                        <div class="dropdown-option" data-value="Shopping">Shopping</div>
                                    </div>
                                </div>
                            </div>

                            <button class="add-btn" data-action="showAddPasswordModal">
                                <i class="fas fa-plus"></i> Add Password
                            </button>
                        </div>
                        <div id="allPasswordsList">
                            <div class="loading" id="allPasswordsLoading">
                                <div class="spinner"></div>
                                <div>Loading passwords...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sharing Center View -->
                <div id="sharingCenterView" class="hidden">
                    <div id="sharingCenterContent">
                        <!-- Content will be dynamically loaded based on user's plan -->
                    </div>
                </div>

                <!-- Family Sharing View -->
                <div id="familySharingView" class="hidden">
                    <div id="familySharingContent">
                        <!-- Content will be dynamically loaded based on user's plan -->
                    </div>
                </div>

                <!-- Subscription View -->
                <div id="subscriptionView" class="hidden">
                    <div class="premium-feature">
                        <i class="fas fa-crown premium-icon"></i>
                        <h2 class="premium-title">SecurePass Subscription Plans</h2>
                        <p class="premium-description">Choose the perfect plan for your security needs. You can switch between plans at any time.</p>
                    </div>

                    <div class="pricing-plans">
                        <!-- Free Plan (Only shown for free users) -->
                        <div class="pricing-card hidden" id="freePlanCard">
                            <h3 class="plan-name">Free</h3>
                            <div class="plan-price">$0</div>
                            <div class="plan-period">forever</div>
                            <ul class="plan-features">
                                <li><i class="fas fa-check"></i> Up to 50 passwords</li>
                                <li><i class="fas fa-check"></i> Basic security features</li>
                                <li><i class="fas fa-check"></i> Single device sync</li>
                                <li><i class="fas fa-times text-danger"></i> <span class="text-danger">No sharing features</span></li>
                                <li><i class="fas fa-times text-danger"></i> <span class="text-danger">No family sharing</span></li>
                                <li><i class="fas fa-times text-danger"></i> <span class="text-danger">Limited support</span></li>
                            </ul>
                            <button class="btn btn-secondary" id="freePlanBtn" disabled>Current Plan</button>
                        </div>

                        <!-- Premium Plan -->
                        <div class="pricing-card featured" id="premiumPlanCard">
                            <h3 class="plan-name">Premium</h3>
                            <div class="plan-price">$4.99</div>
                            <div class="plan-period">per year</div>
                            <ul class="plan-features">
                                <li><i class="fas fa-check"></i> Unlimited passwords</li>
                                <li><i class="fas fa-check"></i> Advanced security features</li>
                                <li><i class="fas fa-check"></i> Multi-device sync</li>
                                <li><i class="fas fa-check"></i> Password sharing</li>
                                <li><i class="fas fa-check"></i> Priority support</li>
                                <li><i class="fas fa-times text-danger"></i> <span class="text-danger">No family sharing</span></li>
                            </ul>
                            <button class="btn btn-primary premium-btn" id="premiumPlanBtn">
                                Upgrade to Premium
                            </button>
                            <div id="premiumCancelSection" class="cancel-section">
                                <button class="btn btn-secondary w-100" id="cancelPremiumBtn">
                                    Cancel Premium Subscription
                                </button>
                            </div>
                        </div>

                        <!-- Family Plan -->
                        <div class="pricing-card" id="familyPlanCard">
                            <h3 class="plan-name">Family</h3>
                            <div class="plan-price">$9.99</div>
                            <div class="plan-period">per year</div>
                            <ul class="plan-features">
                                <li><i class="fas fa-check"></i> Everything in Premium</li>
                                <li><i class="fas fa-check"></i> Up to 10 family members</li>
                                <li><i class="fas fa-check"></i> Family management dashboard</li>
                                <li><i class="fas fa-check"></i> Child account controls</li>
                                <li><i class="fas fa-check"></i> Emergency access</li>
                                <li><i class="fas fa-check"></i> 24/7 premium support</li>
                            </ul>
                            <button class="btn btn-primary premium-btn" id="familyPlanBtn">
                                Choose Family Plan
                            </button>
                            <div id="familyCancelSection" class="cancel-section">
                                <button class="btn btn-secondary w-100" id="cancelFamilyBtn">
                                    Cancel Family Subscription
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Current Plan Info -->
                    <div id="currentPlanInfo" class="current-plan-info">
                        <h3>Your Current Plan: <span id="currentPlanDisplay">Free</span></h3>
                        <p id="planDescription">You're currently on the Free plan with basic features.</p>
                        
                        <!-- What You're Missing Section (Only shown for free users) -->
                        <div id="missingFeatures" class="missing-features hidden">
                            <h4><i class="fas fa-exclamation-triangle"></i> What You're Missing:</h4>
                            <ul>
                                <li>Password sharing with team members</li>
                                <li>Family sharing for up to 10 members</li>
                                <li>Advanced security features</li>
                                <li>Multi-device synchronization</li>
                                <li>Priority customer support</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Security View -->
                <div id="securityView" class="hidden">
                    <div id="securityContent">
                        <!-- Content will be dynamically loaded based on user's plan -->
                    </div>
                </div>

                <!-- Activity Log View -->
                <div id="activityLogView" class="hidden">
                    <div id="activityLogContent">
                        <!-- Content will be dynamically loaded based on user's plan -->
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settingsView" class="hidden">
                    <div class="settings-container">
                        <div class="settings-section">
                            <div class="settings-title">Appearance</div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-label">Dark Mode</div>
                                    <div class="settings-description">Switch between light and dark themes</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkModeToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-title">Security</div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-label">Biometric Authentication</div>
                                    <div class="settings-description">Use fingerprint or face recognition for quick access</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="biometricToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="biometric-options hidden" id="biometricOptions">
                                <div class="biometric-option">
                                    <div class="biometric-icon">
                                        <i class="fas fa-fingerprint"></i>
                                    </div>
                                    <div>
                                        <div class="settings-label">Fingerprint</div>
                                        <div class="settings-description">Use your fingerprint to unlock the app</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="fingerprintToggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="biometric-option">
                                    <div class="biometric-icon">
                                        <i class="fas fa-user-circle"></i>
                                    </div>
                                    <div>
                                        <div class="settings-label">Face Recognition</div>
                                        <div class="settings-description">Use face recognition to unlock the app</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="faceRecognitionToggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-title">Account</div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-label">Change Password</div>
                                    <div class="settings-description">Update your account password</div>
                                </div>
                                <button class="btn btn-secondary" data-action="showChangePasswordModal">Change</button>
                            </div>
                            <div class="settings-item">
                                <div>
                                    <div class="settings-label">Change PIN</div>
                                    <div class="settings-description">Update your 4-digit security PIN</div>
                                </div>
                                <button class="btn btn-secondary" data-action="showChangePinModal">Change</button>
                            </div>
                        </div>


                        <!-- Family Management Section (Only shown for Family plan users) -->
                        <!-- Family Management Section (Only shown for Family plan users) -->
                        <div class="settings-section hidden" id="familyManagementSection">
                            <div class="settings-title">Family Management</div>
                        
                        <!-- Delete Family Group - Only shown to owner -->
                        <div class="settings-item hidden" id="deleteFamilyItem">
                                <div>
                                    <div class="settings-label">Delete Family Group</div>
                                    <div class="settings-description">Permanently delete your family group and remove all members. Members will be restored to their previous plans.</div>
                                </div>
                            <button class="danger-btn" data-action="showDeleteFamilyModal">Delete Family Group</button>
                        </div>
                        
                        <!-- Leave Family Group - Only shown to non-owner parent members -->
                        <div class="settings-item hidden" id="leaveFamilyItem">
                            <div>
                            <div class="settings-label">Leave Family Group</div>
                            <div class="settings-description">Leave the family group. You'll be restored to your previous plan.</div>
                            </div>
                            <button class="danger-btn" data-action="showLeaveFamilyModal">Leave Family Group</button>
                        </div>

                        <!-- Child Account Message - Only shown to child accounts -->
                        <div class="settings-item hidden" id="childAccountMessage">
                            <div>
                            <div class="settings-label">Child Account</div>
                            <div class="settings-description">As a child account, you cannot leave the family. Please ask the family owner to remove you if needed.</div>
                            </div>
                        </div>
                        </div>

                        <div class="danger-zone">
                            <div class="settings-title">Danger Zone</div>

                            <!-- [NEW] Change Email Item -->
                            <div class="settings-item">
                                <div>
                                    <div class="settings-label">Change Account Email</div>
                                    <div class="settings-description">Update the email address used for logging in.</div>
                                </div>
                                <button class="danger-btn" data-action="showChangeEmailModal">Change Email</button>
                            </div>
                            
                            <div class="settings-item">
                                <div>
                                    <div class="settings-label">Delete Account</div>
                                    <div class="settings-description">Permanently delete your account and all stored passwords</div>
                                </div>
                                <button class="danger-btn" data-action="showDeleteAccountModal">Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Password Modal -->
    <div class="modal" id="addPasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Password</div>
                <button class="close-modal" data-action="closeModal" data-arg="addPasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Website/Service</label>
                    <input type="text" class="form-control" id="passwordWebsite" placeholder="e.g., Google">
                </div>
                <div class="form-group">
                    <label class="form-label">Username/Email</label>
                    <input type="text" class="form-control" id="passwordUsername" placeholder="e.g., john@gmail.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="passwordValue" placeholder="Enter password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="passwordValue">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="security-indicator">
                        <div class="security-strength" id="passwordStrength"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-control" id="passwordCategory">
                        <option value="Personal">Personal</option>
                        <option value="Work">Work</option>
                        <option value="Social">Social</option>
                        <option value="Banking">Banking</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Shopping">Shopping</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="text" class="form-control" id="passwordUrl" placeholder="https://">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-control" id="passwordNotes" rows="3" placeholder="Add any notes..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="addPasswordModal">Cancel</button>
                <button class="btn btn-primary" data-action="addPassword">Save Password</button>
            </div>
        </div>
    </div>


    <!-- Add to Family Vault Modal -->
    <div class="modal" id="addFamilyVaultModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add to Family Vault</div>
                <button class="close-modal" data-action="closeModal" data-arg="addFamilyVaultModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Website/Service</label>
                    <input type="text" class="form-control" id="familyVaultWebsite" placeholder="e.g., Netflix">
                </div>
                <div class="form-group">
                    <label class="form-label">Username/Email</label>
                    <input type="text" class="form-control" id="familyVaultUsername" placeholder="e.g., family@email.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="familyVaultPassword" placeholder="Enter password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="familyVaultPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="security-indicator">
                        <div class="security-strength" id="familyVaultPasswordStrength"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Share With</label>
                    <select class="form-control" id="familyVaultShareWith">
                        <option value="all">All Family Members</option>
                        <option value="parents">Parents Only</option>
                        <option value="specific">Specific Member</option>
                    </select>
                </div>
                <div class="form-group hidden" id="specificMemberGroup">
                    <label class="form-label">Select Family Member</label>
                    <select class="form-control" id="familyVaultSpecificMember">
                        <!-- Dynamically populated -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-control" id="familyVaultCategory">
                        <option value="Entertainment">Entertainment</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Travel">Travel</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="text" class="form-control" id="familyVaultUrl" placeholder="https://">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-control" id="familyVaultNotes" rows="3" placeholder="Add any notes..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="addFamilyVaultModal">Cancel</button>
                <button class="btn btn-primary" data-action="addToFamilyVault">Add to Family Vault</button>
            </div>
        </div>
    </div>

    <!-- Share to Family Vault Modal -->
    <div class="modal" id="shareToFamilyVaultModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Share to Family Vault</div>
                <button class="close-modal" data-action="closeModal" data-arg="shareToFamilyVaultModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Share With</label>
                    <select class="form-control" id="shareToFamilyVaultWith">
                        <option value="all">All Family Members</option>
                        <option value="parents">Parents Only</option>
                        <option value="specific">Specific Member</option>
                    </select>
                </div>
                <div class="form-group hidden" id="shareSpecificMemberGroup">
                    <label class="form-label">Select Family Member</label>
                    <select class="form-control" id="shareToFamilyVaultSpecificMember">
                        <!-- Dynamically populated -->
                    </select>
                </div>
                <div class="share-options">
                    <h4>Family Vault Sharing</h4>
                    <p class="share-options-text">
                        Share this password with your family members. They will need their PIN to view it.
                    </p>
                    <div class="share-options-flex">
                        <i class="fas fa-shield-alt share-options-icon"></i>
                        <span class="share-options-info">
                            All family members need their PIN to view vault passwords
                        </span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="shareToFamilyVaultModal">Cancel</button>
                <button class="btn btn-primary" data-action="shareToFamilyVault">Share to Vault</button>
            </div>
        </div>
    </div>

    <!-- PIN Verification Modal -->
    <div class="modal" id="pinModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="pinModalTitle">Enter PIN to View Password</div>
                <button class="close-modal" data-action="closeModal" data-arg="pinModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="pinModalDescription">For security reasons, please enter your PIN to view this password.</p>
                <div class="pin-inputs">
                    <input type="password" class="pin-input" maxlength="1" pattern="[0-9]">
                    <input type="password" class="pin-input" maxlength="1" pattern="[0-9]">
                    <input type="password" class="pin-input" maxlength="1" pattern="[0-9]">
                    <input type="password" class="pin-input" maxlength="1" pattern="[0-9]">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary pin-verify-btn" data-action="verifyPin">Verify PIN</button>
                </div>
                <p class="pin-info-text">
                    <i class="fas fa-info-circle"></i> Your PIN is required to decrypt passwords
                </p>
            </div>
        </div>
    </div>

<!-- Password Details Modal -->
<div class="modal" id="passwordDetailsModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" id="passwordDetailsTitle">Password Details</div>
            <button class="close-modal" data-action="closeModal" data-arg="passwordDetailsModal">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Inputs are readonly by default -->
            <div class="form-group">
                <label class="form-label">Website</label>
                <input type="text" class="form-control detail-input" id="detailWebsite" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-control detail-input" id="detailUsername" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-input">
                    <input type="password" class="form-control" id="detailPassword" readonly>
                    <button type="button" class="toggle-password" data-action="togglePassword" data-arg="detailPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="toggle-password copy-btn-position" id="detailCopyBtn" data-action="copyPassword">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-control detail-input" id="detailCategory" disabled>
                    <option value="Personal">Personal</option>
                    <option value="Work">Work</option>
                    <option value="Social">Social</option>
                    <option value="Banking">Banking</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Shopping">Shopping</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">URL</label>
                <input type="text" class="form-control detail-input" id="detailUrl" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea class="form-control detail-input" id="detailNotes" rows="3" readonly></textarea>
            </div>
            
            <div id="sharedPasswordInfo" class="hidden">
                <div class="form-group">
                    <label class="form-label">Shared By</label>
                    <input type="text" class="form-control" id="detailSharedBy" readonly>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <!-- Buttons trigger via data-action in app.js -->
            <button class="btn btn-primary" id="btnEditPassword" data-action="enableEditMode">Edit</button>
            <button class="btn btn-secondary hidden" id="btnCancelEdit" data-action="cancelEditMode">Cancel</button>
            <button class="btn btn-primary hidden" id="btnSaveEdit" data-action="saveEditedPassword">Save Changes</button>
            <button class="btn btn-secondary" id="btnCloseDetails" data-action="closeModal" data-arg="passwordDetailsModal">Close</button>
        </div>
    </div>
</div>


<!-- Claim Invite Modal -->
<div class="modal" id="claimInviteModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Redeem Invite Code</div>
            <button class="close-modal" data-action="closeModal" data-arg="claimInviteModal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Enter the code from your email to unlock the password.</p>
            <div class="form-group">
                <label class="form-label">Invite Code</label>
                <!-- FIX: Removed style attribute, added 'invite-code-input' class -->
                <input type="text" class="form-control invite-code-input" id="claimCodeInput" placeholder="ABCD-1234">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-action="closeModal" data-arg="claimInviteModal">Cancel</button>
            <button class="btn btn-primary" data-action="submitClaimInvite">Redeem</button>
        </div>
    </div>
</div>

    
    <!-- QR Scanner Modal [NEW] -->
    <div class="modal" id="qrScannerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Scan QR Code</div>
                <button class="close-modal" data-action="closeQrScannerModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Position the QR code within the frame to scan it.</p>
                <div id="qr-reader" class="qr-reader-container"></div>
                <div id="qr-reader-results"></div>
            </div>
        </div>
    </div>

    <!-- QR Code Display Modal [NEW] -->
    <div class="modal" id="qrCodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Share with QR Code</div>
                <button class="close-modal" data-action="closeModal" data-arg="qrCodeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="qr-info-text">Have the recipient scan this code. It is valid for 5 minutes and can only be used once.</p>
                <div id="qrCodeContainer">
                    <div class="spinner"></div>
                </div>
                <div class="alert alert-error alert-center">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Important:</strong> Do not share a screenshot of this QR code.
                </div>
            </div>
        </div>
    </div>

    <!-- Share Password Modal -->
    <div class="modal" id="sharePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Share Password</div>
                <button class="close-modal" data-action="closeModal" data-arg="sharePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Recipient Email</label>
                    <input type="email" class="form-control" id="shareEmail" placeholder="Enter recipient's email">
                </div>
                <div class="form-group">
                    <label class="form-label">Access Level</label>
                    <select class="form-control" id="shareAccessLevel">
                        <option value="view">View Only</option>
                        <option value="edit">Can Edit</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Expires In (Optional)</label>
                    <select class="form-control" id="shareExpires">
                        <option value="">Never</option>
                        <option value="24">24 Hours</option>
                        <option value="168">7 Days</option>
                        <option value="720">30 Days</option>
                    </select>
                </div>
                 <div class="share-options">
                    <h4>Or Share Instantly</h4>
                     <button class="btn btn-secondary qr-generate-btn" data-action="generateQrCodeForSharing">
                        <i class="fas fa-qrcode"></i> Generate QR Code
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="sharePasswordModal">Cancel</button>
                <button class="btn btn-primary" data-action="sharePassword">Share via Email</button>
            </div>
        </div>
    </div>

    <!-- Create Family Modal -->
    <div class="modal" id="createFamilyModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Family Group</div>
                <button class="close-modal" data-action="closeModal" data-arg="createFamilyModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Family Group Name</label>
                    <input type="text" class="form-control" id="familyName" placeholder="Enter family group name" value="My Family">
                </div>
                <div class="share-options">
                    <h4>Family Sharing Benefits</h4>
                    <ul class="benefits-list">
                        <li>Share passwords securely with up to 10 family members</li>
                        <li>Parental controls for child accounts</li>
                        <li>Emergency access for trusted family members</li>
                        <li>Family vault for shared accounts</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="createFamilyModal">Cancel</button>
                <button class="btn btn-primary" data-action="createFamilyGroup">Create Family Group</button>
            </div>
        </div>
    </div>

    <!-- Invite Family Member Modal -->
    <div class="modal" id="inviteFamilyModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Invite Family Member</div>
                <button class="close-modal" data-action="closeModal" data-arg="inviteFamilyModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="familyInviteEmail" placeholder="Enter family member's email">
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-control" id="familyMemberRole">
                        <option value="parent">Parent (Full Access)</option>
                        <option value="child">Child (Limited Access)</option>
                    </select>
                </div>
                <div class="share-options">
                    <h4>Role Permissions</h4>
                    <div id="rolePermissions" class="role-permissions-text">
                        <!-- Role permissions will be dynamically updated -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="inviteFamilyModal">Cancel</button>
                <button class="btn btn-primary" data-action="inviteFamilyMember">Send Invitation</button>
            </div>
        </div>
    </div>

    <!-- Delete Family Modal -->
    <div class="modal" id="deleteFamilyModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Delete Family Group</div>
                <button class="close-modal" data-action="closeModal" data-arg="deleteFamilyModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Warning:</strong> This action cannot be undone. All family members will be removed and the family group will be permanently deleted.
                </div>
                <div class="form-group">
                    <label class="form-label">Enter your password to confirm</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="deleteFamilyPassword" placeholder="Enter your password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="deleteFamilyPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Type "DELETE FAMILY" to confirm</label>
                    <input type="text" class="form-control" id="deleteFamilyConfirmation" placeholder="Type DELETE FAMILY">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="deleteFamilyModal">Cancel</button>
                <button class="btn btn-danger" data-action="deleteFamilyGroup">Delete Family Group</button>
            </div>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal" id="deleteAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Delete Account</div>
                <button class="close-modal" data-action="closeModal" data-arg="deleteAccountModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Warning:</strong> This action cannot be undone. All your passwords and data will be permanently deleted.
                </div>
                <div class="form-group">
                    <label class="form-label">Enter your password to confirm</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="deleteAccountPassword" placeholder="Enter your password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="deleteAccountPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Type "DELETE" to confirm</label>
                    <input type="text" class="form-control" id="deleteConfirmation" placeholder="Type DELETE">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="deleteAccountModal">Cancel</button>
                <button class="btn btn-danger" data-action="deleteAccount">Delete Account</button>
            </div>
        </div>
    </div>

    <div class="modal" id="changeEmailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Change Account Email</div>
                <button class="close-modal" data-action="closeModal" data-arg="changeEmailModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert" id="changeEmailAlert"></div>
                <div id="changeEmailStep1">
                    <div class="form-group">
                        <label class="form-label">New Email Address</label>
                        <input type="email" class="form-control" id="newEmail" placeholder="Enter your new email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Your Current Password</label>
                        <div class="password-input">
                            <input type="password" class="form-control" id="changeEmailPassword" placeholder="Enter your current password">
                            <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changeEmailPassword"><i class="fas fa-eye"></i></button>
                        </div>
                    </div>
                </div>
                <div id="changeEmailStep2" class="hidden">
                    <p>A verification code has been sent to <strong id="newEmailDisplay"></strong>. Please enter it below.</p>
                    <div class="form-group">
                        <label class="form-label">Verification Code</label>
                        <input type="text" class="form-control" id="changeEmailCode" placeholder="Enter 6-digit code">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="changeEmailModal">Cancel</button>
                <button id="changeEmailStep1Btn" class="btn btn-primary" data-action="requestEmailChange">Request Change</button>
                <button id="changeEmailStep2Btn" class="btn btn-primary hidden" data-action="verifyEmailChange">Confirm Change</button>
            </div>
        </div>
    </div>

    <!-- Success Notification -->
    <div class="notification" id="successNotification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">Password saved successfully!</span>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Change Password</div>
                <button class="close-modal" data-action="closeModal" data-arg="changePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert" id="changePasswordAlert"></div>
                <div class="form-group">
                    <label class="form-label">Current Password</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="changePasswordCurrent" placeholder="Enter current password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changePasswordCurrent">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="changePasswordNew" placeholder="Enter new password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changePasswordNew">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm New Password</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="changePasswordConfirm" placeholder="Confirm new password">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changePasswordConfirm">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="changePasswordModal">Cancel</button>
                <button class="btn btn-primary" data-action="changePassword">Update Password</button>
            </div>
        </div>
    </div>

    <!-- Change PIN Modal -->
    <div class="modal" id="changePinModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Change Security PIN</div>
                <button class="close-modal" data-action="closeModal" data-arg="changePinModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert" id="changePinAlert"></div>
                <div class="form-group">
                    <label class="form-label">Current PIN</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="changePinCurrent" placeholder="Enter current 4-digit PIN" maxlength="4" pattern="\d{4}">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changePinCurrent">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">New PIN</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="changePinNew" placeholder="Enter new 4-digit PIN" maxlength="4" pattern="\d{4}">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changePinNew">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm New PIN</label>
                    <div class="password-input">
                        <input type="password" class="form-control" id="changePinConfirm" placeholder="Confirm new 4-digit PIN" maxlength="4" pattern="\d{4}">
                        <button type="button" class="toggle-password" data-action="togglePassword" data-arg="changePinConfirm">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="closeModal" data-arg="changePinModal">Cancel</button>
                <button class="btn btn-primary" data-action="changePin">Update PIN</button>
            </div>
        </div>
    </div>


    <script src="js/app.js"></script>
</body>
</html>
